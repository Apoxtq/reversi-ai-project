# Bitboard学习笔记 - Day 1

> **日期**: 2025年10月8日  
> **学习时间**: 2小时  
> **目标**: 阅读Egaroucid bit.hpp前200行，理解Bitboard基本概念  
> **参考文件**: `D:\大三390毕业选课黑白棋项目\他人成熟黑白棋项目参考\Egaroucid\src\engine\bit.hpp`

---

## 📋 今日学习任务

- [ ] 阅读bit.hpp Line 1-50（第1个番茄钟）
- [ ] 阅读bit.hpp Line 51-100（第2个番茄钟）
- [ ] 阅读bit.hpp Line 101-150（第3个番茄钟）
- [ ] 阅读bit.hpp Line 151-200（第4个番茄钟）
- [ ] 完善学习笔记（第5个番茄钟）

---

## 1. Bitboard基本概念

### 1.1 什么是Bitboard？

**定义**:
- Bitboard是一种使用位运算表示棋盘状态的数据结构
- 用64位整数（`uint64_t`）表示8x8的黑白棋盘
- 每一位代表棋盘上的一个格子

**优势**:
- ✅ **高效**: 使用CPU原生的64位运算
- ✅ **快速**: 移动生成和棋子翻转都是位运算
- ✅ **紧凑**: 整个棋盘状态只需两个64位整数

**示例**:
```cpp
// 棋盘初始状态
uint64_t player = 0x0000000810000000ULL;    // 玩家的棋子
uint64_t opponent = 0x0000001008000000ULL;  // 对手的棋子

// 棋盘表示：
// 8 . . . . . . . .
// 7 . . . . . . . .
// 6 . . . . . . . .
// 5 . . . ○ ● . . .
// 4 . . . ● ○ . . .
// 3 . . . . . . . .
// 2 . . . . . . . .
// 1 . . . . . . . .
//   A B C D E F G H
```

### 1.2 位索引约定

**坐标系统**:
```
索引编号（从0-63）:
 0  1  2  3  4  5  6  7
 8  9 10 11 12 13 14 15
16 17 18 19 20 21 22 23
24 25 26 27 28 29 30 31
32 33 34 35 36 37 38 39
40 41 42 43 44 45 46 47
48 49 50 51 52 53 54 55
56 57 58 59 60 61 62 63
```

**坐标转换**:
```cpp
// (x, y) → index
int index = y * 8 + x;

// index → (x, y)
int x = index % 8;
int y = index / 8;
```

---

## 2. 关键代码分析

### 代码片段 1: [Line XX-XX]

```cpp
// 复制关键代码到这里
[待填写]
```

**我的理解**:
- 这个函数/代码做什么...
- 为什么要这样写...
- 位运算的作用是...

**疑问**:
- ❓ [标记不理解的地方]

---

### 代码片段 2: [Line XX-XX]

```cpp
// 复制关键代码
[待填写]
```

**我的理解**:
- ...

**疑问**:
- ❓ ...

---

### 代码片段 3: [Line XX-XX]

```cpp
// 复制关键代码
[待填写]
```

**我的理解**:
- ...

**疑问**:
- ❓ ...

---

## 3. 核心位运算操作

### 3.1 基础位运算

| 运算 | 符号 | 示例 | 用途 |
|------|------|------|------|
| AND | `&` | `board & mask` | 检查某位是否为1 |
| OR | `\|` | `board \| new_bit` | 设置某位为1 |
| XOR | `^` | `board ^ bit` | 翻转某位 |
| NOT | `~` | `~board` | 所有位取反 |
| 左移 | `<<` | `1ULL << pos` | 创建单个bit |
| 右移 | `>>` | `board >> 8` | 向下移动一行 |

### 3.2 常用技巧

**1. 检查某位是否为1**:
```cpp
bool isBitSet(uint64_t board, int pos) {
    return (board & (1ULL << pos)) != 0;
}
```

**2. 设置某位为1**:
```cpp
uint64_t setBit(uint64_t board, int pos) {
    return board | (1ULL << pos);
}
```

**3. 清除某位（设为0）**:
```cpp
uint64_t clearBit(uint64_t board, int pos) {
    return board & ~(1ULL << pos);
}
```

**4. 计算棋子数量**:
```cpp
int popcount(uint64_t board) {
    return __builtin_popcountll(board);  // GCC内建函数
}
```

---

## 4. 移动方向的位运算

### 4.1 八个方向

```
西北  北  东北
  ↖  ↑  ↗
西 ←  ●  → 东
  ↙  ↓  ↘
西南  南  东南
```

### 4.2 方向移位

| 方向 | 位移操作 | 边界检查 |
|------|---------|---------|
| 北 (N) | `board << 8` | 无需检查 |
| 南 (S) | `board >> 8` | 无需检查 |
| 东 (E) | `board << 1` | 需要屏蔽H列 |
| 西 (W) | `board >> 1` | 需要屏蔽A列 |
| 东北 (NE) | `board << 9` | 需要屏蔽H列 |
| 西北 (NW) | `board << 7` | 需要屏蔽A列 |
| 东南 (SE) | `board >> 7` | 需要屏蔽H列 |
| 西南 (SW) | `board >> 9` | 需要屏蔽A列 |

**边界掩码**:
```cpp
const uint64_t MASK_A = 0xFEFEFEFEFEFEFEFEULL;  // 屏蔽A列
const uint64_t MASK_H = 0x7F7F7F7F7F7F7F7FULL;  // 屏蔽H列
```

---

## 5. 今日收获

### 5.1 核心概念理解

✅ **已掌握**:
- Bitboard用64位整数表示8x8棋盘
- 位索引从0-63，左上角是0，右下角是63
- 基础位运算：AND, OR, XOR, NOT, 移位
- [其他掌握的知识点...]

⏳ **部分理解**:
- [还需进一步理解的概念...]

❓ **待解决疑问**:
- [标记的问题...]

### 5.2 实用技巧

1. **位运算优于循环**: 能用位运算就不要用循环
2. **掩码的重要性**: 边界检查必须使用掩码
3. **常量定义**: 常用掩码应该预定义为常量
4. **[其他技巧...]**

### 5.3 代码质量观察

**Egaroucid代码特点**:
- 极致的性能优化
- 大量使用内联函数
- 预计算和查表
- [其他特点...]

---

## 6. 明天计划

### Day 2 任务（10月9日）
- [ ] 阅读bit.hpp Line 200-500
- [ ] 重点关注：合法移动生成算法
- [ ] 学习目标：理解如何用位运算找出所有合法移动

### 预习问题
1. 如何用位运算判断某个位置是否合法？
2. 8个方向的合法移动如何统一处理？
3. 性能优化的关键技巧是什么？

---

## 7. 番茄钟记录

| 番茄 | 时间 | 任务 | 完成度 |
|------|------|------|--------|
| 🍅 1 | 19:05-19:30 | 阅读Line 1-50 | [待填] |
| 🍅 2 | 19:35-20:00 | 阅读Line 51-100 | [待填] |
| 🍅 3 | 20:05-20:30 | 阅读Line 101-150 | [待填] |
| 🍅 4 | 20:35-21:00 | 阅读Line 151-200 | [待填] |
| ☕ | 21:00-21:15 | 长休息 | - |
| 🍅 5 | 21:15-21:40 | 完善笔记 | [待填] |
| 🍅 6 | 21:45-22:10 | Git提交 | [待填] |

**总学习时间**: ___ 小时  
**有效学习时间**: ___ 小时  
**效率**: ___% （有效时间/总时间）

---

## 8. 参考资料

### 文档链接
- [Chess Programming Wiki - Bitboards](https://www.chessprogramming.org/Bitboards)
- [Egaroucid GitHub](https://github.com/Nyanyan/Egaroucid)
- [项目参考路线图](../../参考项目总览与学习路线图.md)

### 相关文件
- `bit.hpp`: Bitboard核心操作
- `flip.hpp`: 翻转算法实现
- `board.hpp`: 棋盘状态管理

---

## 💡 学习心得

### 今日感悟
[写下今天学习的感受、困难、收获...]

### 遇到的困难
1. [困难1及如何解决]
2. [困难2及如何解决]

### 下次改进
1. [改进建议1]
2. [改进建议2]

---

**学习状态**: 🔄 进行中  
**完成进度**: Week 1 - Day 1  
**下次学习**: 2025年10月9日（Day 2）

---

*记录你的学习历程，每一步都在进步！* 💪

